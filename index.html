<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ³¢å…”æ‘å†’éšªï¼šæˆ‘çš„èƒ½åŠ›å±•ç¤º (ASCII åœ°åœ–)</title>
    <style>
        /* æ•´é«”ä½ˆå±€ */
        body {
            display: flex;
            flex-direction: column;
            height: 100vh;
            margin: 0;
            font-family: "å¾®è»Ÿæ­£é»‘é«”", Arial, sans-serif;
            background-color: #e0f2f7;
            overflow: hidden; /* é˜²æ­¢æ»¾å‹•æ¢ */
        }
        #game-wrapper {
            display: flex;
            flex-direction: column;
            flex: 1;
            max-width: 1200px; /* é™åˆ¶éŠæˆ²å¯¬åº¦ */
            width: 100%;
            margin: 0 auto; /* å±…ä¸­é¡¯ç¤º */
            background-color: #fff;
            box-shadow: 0 0 15px rgba(0,0,0,0.1);
            border-radius: 8px;
            overflow: hidden;
        }

        /* æ¨™é¡Œå€å¡Š */
        #game-header {
            background-color: #4dd0e1;
            color: white;
            padding: 15px 20px;
            text-align: center;
            font-size: 1.5em;
            font-weight: bold;
        }

        /* éŠæˆ²ä¸»å…§å®¹å€ */
        #game-container {
            display: flex;
            flex: 1; /* è®“å…§å®¹å€å¡Šä½”æ»¿å¯ç”¨ç©ºé–“ */
            padding: 15px;
            gap: 15px; /* å…ƒç´ é–“è· */
            overflow: hidden; /* é˜²æ­¢å…§éƒ¨å…ƒç´ æº¢å‡º */
        }

        /* ä¸»ç•«é¢ */
        #main-screen {
            flex: 3; /* ä¸»ç•«é¢ä½”å¤§éƒ¨åˆ†ç©ºé–“ */
            background-color: #ffffff;
            border: 1px solid #b2ebf2;
            border-radius: 8px;
            padding: 15px;
            overflow: auto; /* å…§å®¹è¶…å‡ºæ™‚å¯æ»¾å‹• */
            display: flex; /* è®“å…§éƒ¨å…§å®¹å¯ä»¥å½ˆæ€§ä½ˆå±€ */
            justify-content: center; /* å…§å®¹æ°´å¹³ç½®ä¸­ */
            align-items: center; /* å…§å®¹å‚ç›´ç½®ä¸­ */
            font-size: 24px;
            color: #555;
            flex-direction: column; /* å…è¨±å‚ç›´æ’åˆ—å…§å®¹ */
        }

        /* è¨Šæ¯æ¡† */
        #message-box {
            flex: 1; /* è¨Šæ¯æ¡†ä½”å‰©é¤˜ç©ºé–“ */
            background-color: #e0f7fa;
            border: 1px solid #b2ebf2;
            border-radius: 8px;
            padding: 10px;
            display: flex;
            flex-direction: column;
            overflow-y: auto; /* è¨Šæ¯éå¤šæ™‚å¯æ»¾å‹• */
            font-size: 0.9em;
        }
        .message {
            background-color: #ffffff;
            padding: 8px;
            margin-bottom: 5px;
            border-radius: 5px;
            word-wrap: break-word; /* è‡ªå‹•æ›è¡Œ */
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .message.system {
            background-color: #fce4ec;
            color: #880e4f;
            font-style: italic;
            text-align: center;
        }
        .message.dialog {
            background-color: #e8f5e9;
            color: #2e7d32;
        }
        .message.event {
            background-color: #e3f2fd;
            color: #1565c0;
        }

        /* æ“ä½œæŒ‰éˆ• */
        #game-controls {
            display: flex;
            justify-content: center;
            padding: 15px;
            gap: 10px;
            background-color: #fafafa;
            border-top: 1px solid #b2ebf2;
            flex-wrap: wrap; /* æŒ‰éˆ•æ›è¡Œ */
        }
        .game-button {
            padding: 12px 20px;
            font-size: 16px;
            cursor: pointer;
            background-color: #00bcd4; /* é’è‰²æŒ‰éˆ• */
            color: white;
            border: none;
            border-radius: 5px;
            transition: background-color 0.3s ease, transform 0.1s ease;
            min-width: 120px; /* æœ€å°å¯¬åº¦ */
        }
        .game-button:hover {
            background-color: #00acc1;
            transform: translateY(-2px);
        }
        .game-button:active {
            transform: translateY(0);
        }

        /* ASCII åœ°åœ–ç‰¹å®šæ¨£å¼ */
        #ascii-map-container {
            position: relative; /* è®“å…§éƒ¨åœ°é»å¯ä»¥çµ•å°å®šä½ */
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace; /* ç­‰å¯¬å­—é«”ç¢ºä¿ASCIIæ’ç‰ˆ */
            white-space: pre; /* ä¿ç•™æ‰€æœ‰ç©ºç™½å’Œæ›è¡Œ */
            background-color: #f0f4c3; /* æ·ºé»ƒç¶ è‰²èƒŒæ™¯ */
            color: #424242; /* æ·±ç°è‰²æ–‡å­— */
            padding: 20px;
            border-radius: 8px;
            line-height: 1.2; /* èª¿æ•´è¡Œé«˜ */
            font-size: 16px; /* èª¿æ•´å­—é«”å¤§å° */
            width: 95%; /* ä½”æ“šå®¹å™¨å¤§éƒ¨åˆ†å¯¬åº¦ */
            height: 95%; /* ä½”æ“šå®¹å™¨å¤§éƒ¨åˆ†é«˜åº¦ */
            overflow: auto; /* å¦‚æœåœ°åœ–å¤ªå¤§å¯ä»¥æ»¾å‹• */
        }

        /* ç¢ºä¿åœ°åœ–å…§å®¹é¡¯ç¤ºåœ¨å®¹å™¨ä¸­é–“ */
        #main-screen.ascii-map-mode {
            justify-content: flex-start; /* è®“å…§å®¹é ä¸Šå°é½Šï¼Œå› ç‚ºASCIIåœ°åœ–é€šå¸¸æ˜¯å¾å·¦ä¸Šè§’é–‹å§‹ */
            align-items: flex-start;
        }


        .map-location {
            position: absolute;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            border: 2px solid transparent; /* é è¨­é€æ˜é‚Šæ¡† */
            transition: border-color 0.2s ease, background-color 0.2s ease;
            z-index: 10; /* ç¢ºä¿ç†±å€åœ¨ASCIIæ–‡å­—ä¹‹ä¸Š */
        }
        .map-location:hover {
            border-color: #ffeb3b; /* æ»‘é¼ æ‡¸åœæ™‚é¡¯ç¤ºé»ƒè‰²é‚Šæ¡† */
            background-color: rgba(255, 255, 0, 0.1); /* è¼•å¾®èƒŒæ™¯è‰²æç¤º */
        }
        .location-name {
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 14px;
            white-space: nowrap;
            opacity: 0; /* é è¨­éš±è—åç¨± */
            pointer-events: none; /* è®“åç¨±ä¸æœƒé˜»æ“‹é»æ“Šäº‹ä»¶ */
            transition: opacity 0.2s ease;
            position: absolute; /* çµ•å°å®šä½åœ¨ç†±å€å…§ */
            bottom: 105%; /* é¡¯ç¤ºåœ¨ç†±å€ä¸Šæ–¹ */
            left: 50%;
            transform: translateX(-50%);
            z-index: 20; /* ç¢ºä¿åç¨±åœ¨ç†±å€ä¹‹ä¸Š */
        }
        .map-location:hover .location-name {
            opacity: 1; /* æ»‘é¼ æ‡¸åœæ™‚é¡¯ç¤ºåç¨± */
        }

        /* é€šç”¨ç•«é¢æ¨£å¼ */
        .generic-screen {
            text-align: center;
            padding: 20px;
            color: #333;
            max-width: 80%;
        }
        .generic-screen h3 {
            font-size: 1.8em;
            color: #00796b;
            margin-bottom: 15px;
        }
        .generic-screen p {
            font-size: 1.1em;
            line-height: 1.6;
        }

        /* éŸ¿æ‡‰å¼è¨­è¨ˆ */
        @media (max-width: 768px) {
            #game-container {
                flex-direction: column; /* åœ¨å°è¢å¹•ä¸Šå‚ç›´å †ç–Š */
            }
            #main-screen, #message-box {
                flex: none; /* å–æ¶ˆflexä½”æ¯” */
                height: 50vh; /* è¨­ç½®å›ºå®šé«˜åº¦ */
            }
            #main-screen {
                min-height: 300px;
            }
            #message-box {
                min-height: 200px;
            }
            #game-controls {
                flex-direction: column;
                gap: 8px;
            }
            .game-button {
                width: 100%;
            }
        }
    </style>
</head>
<body>

    <div id="game-wrapper">
        <header id="game-header">
            æ³¢å…”æ‘å†’éšª
        </header>

        <main id="game-container">
            <div id="main-screen">
                <h2>éŠæˆ²è¼‰å…¥ä¸­...</h2>
                <p>è«‹ç¨å€™ï¼Œæ³¢å…”æ‘çš„å†’éšªå³å°‡é–‹å§‹ï¼</p>
            </div>
            <div id="message-box">
                <div class="message system">ç³»çµ±: éŠæˆ²å•Ÿå‹•ä¸­...</div>
            </div>
        </main>

        <footer id="game-controls">
            <button class="game-button" id="btn-explore">æ¢ç´¢æ‘èŠ</button>
            <button class="game-button" id="btn-inventory">æˆ‘çš„ç‰©å“</button>
            <button class="game-button" id="btn-skills">å­¸ç¿’æŠ€èƒ½</button>
            <button class="game-button" id="btn-status">è§’è‰²ç‹€æ…‹</button>
            <button class="game-button" id="btn-save">å„²å­˜é€²åº¦</button>
        </footer>
    </div>

    <script>
        // gameEvents.js å…§å®¹ (å·²æ•´åˆåˆ°æ­¤æª”æ¡ˆä¸­)
        const GameEventEmitter = {
            events: {},
            on: function(eventName, listener) {
                if (!this.events[eventName]) { this.events[eventName] = []; }
                this.events[eventName].push(listener);
            },
            emit: function(eventName, data) {
                if (this.events[eventName]) {
                    this.events[eventName].forEach(listener => { listener(data); });
                }
            },
            off: function(eventName, listener) {
                if (this.events[eventName]) {
                    this.events[eventName] = this.events[eventName].filter(l => l !== listener);
                }
            }
        };

        // messageHandler.js å…§å®¹ (å·²æ•´åˆåˆ°æ­¤æª”æ¡ˆä¸­)
        const messageBox = document.getElementById('message-box');
        function addMessage(text, type = 'system') {
            const messageElement = document.createElement('div');
            messageElement.classList.add('message');
            if (type) { messageElement.classList.add(type); }
            messageElement.textContent = text;
            messageBox.appendChild(messageElement);
            messageBox.scrollTop = messageBox.scrollHeight;
        }

        // screenRenderer.js å…§å®¹ (å·²æ•´åˆåˆ°æ­¤æª”æ¡ˆä¸­)
        const mainScreen = document.getElementById('main-screen');

        function loadVillageMap() {
            // æ·»åŠ ä¸€å€‹é¡åˆ¥ï¼Œä»¥ä¾¿åœ¨CSSä¸­èª¿æ•´ä¸»ç•«é¢çš„å°é½Šæ–¹å¼
            mainScreen.classList.add('ascii-map-mode');
            mainScreen.innerHTML = `
                <pre id="ascii-map-container">
            _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
           |                                                               |
           |        å—ç“œæ£®æ—å…¥å£                                           |
           |    ğŸŒ²ğŸŒ²ğŸŒ²ğŸŒ²ğŸŒ²ğŸŒ²ğŸŒ²ğŸŒ²                                         |
           |    ğŸŒ²           ğŸŒ²                                          |
           |    ğŸŒ²           ğŸŒ²                                          |
           |    ğŸŒ²   <M>     ğŸŒ²           æ‘é•·å¸‚æ”¿å»³                       |
           |    ğŸŒ²ğŸŒ²ğŸŒ²ğŸŒ²ğŸŒ²ğŸŒ²ğŸŒ²ğŸŒ²           [ ] [ ] [ ] [ ] [ ] [ ]       |
           |                                   [ ] [ ] [ ] [ ] [ ] [ ]       |
           |                                                               |
           |                                                               |
           |                                                               |
           |                                                               |
           |     æ³¢å…”é›œè²¨åº—                                  ç†Šå¤§éµåŒ é‹ª      |
           |     [__]                                        [_|_|]      |
           |     /  \\                                       | | |       |
           |    |    |                                       |_____|      |
           |    |____|                                                    |
           |                                                               |
           |                                                               |
           |                                                               |
           |     æˆ‘çš„å°å±‹                                   èƒ–æ³¢è¾²å ´       |
           |    /\\_/\                                        ---        |
           |   ( ' ' )                                        | |        |
           |    > ^ <                                        |___|       |
           |                                                               |
           |                                                               |
           |_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _|
                </pre>
                <div class="map-location" id="loc-shop" data-name="æ³¢å…”é›œè²¨åº—"
                     style="left: 10%; top: 46%; width: 15%; height: 12%;">
                    <span class="location-name">æ³¢å…”é›œè²¨åº—</span>
                </div>
                <div class="map-location" id="loc-blacksmith" data-name="ç†Šå¤§éµåŒ é‹ª"
                     style="left: 65%; top: 46%; width: 15%; height: 12%;">
                    <span class="location-name">ç†Šå¤§éµåŒ é‹ª</span>
                </div>
                <div class="map-location" id="loc-townhall" data-name="æ‘é•·å¸‚æ”¿å»³"
                     style="left: 45%; top: 30%; width: 20%; height: 15%;">
                    <span class="location-name">æ‘é•·å¸‚æ”¿å»³</span>
                </div>
                <div class="map-location" id="loc-home" data-name="æˆ‘çš„å°å±‹"
                     style="left: 18%; top: 72%; width: 15%; height: 12%;">
                    <span class="location-name">æˆ‘çš„å°å±‹</span>
                </div>
                <div class="map-location" id="loc-forest" data-name="å—ç“œæ£®æ—å…¥å£"
                     style="left: 15%; top: 10%; width: 20%; height: 20%;">
                    <span class="location-name">å—ç“œæ£®æ—å…¥å£</span>
                </div>
                 <div class="map-location" id="loc-farm" data-name="èƒ–æ³¢è¾²å ´"
                     style="left: 65%; top: 72%; width: 15%; height: 12%;">
                    <span class="location-name">èƒ–æ³¢è¾²å ´</span>
                </div>
            `;

            const locations = mainScreen.querySelectorAll('.map-location');
            locations.forEach(locationDiv => {
                locationDiv.addEventListener('click', () => {
                    const locationName = locationDiv.dataset.name;
                    GameEventEmitter.emit('mapLocationClicked', locationName);
                });
            });

            addMessage('ä½ é€²å…¥äº†é™½å…‰æ™®ç…§çš„æ³¢å…”æ‘ã€‚', 'system');
            GameEventEmitter.emit('screenChanged', 'VillageMap');
        }

        function loadInventoryScreen() {
            mainScreen.classList.remove('ascii-map-mode'); // ç§»é™¤åœ°åœ–æ¨¡å¼çš„å°é½Šæ¨£å¼
            mainScreen.innerHTML = `
                <div class="generic-screen">
                    <h3>æˆ‘çš„ç‰©å“</h3>
                    <p>ä½ ç›®å‰æ²’æœ‰ä»»ä½•ç‰©å“ã€‚(èƒŒåŒ…ç©ºç©ºå¦‚ä¹Ÿ)</p>
                    <p>æœªä¾†ä½ å¯ä»¥åœ¨é€™è£¡æ•´ç†è£å‚™ã€ä½¿ç”¨é“å…·ã€‚</p>
                </div>
            `;
            addMessage('ä½ æ‰“é–‹äº†ç‰©å“æ¸…å–®ã€‚', 'system');
            GameEventEmitter.emit('screenChanged', 'Inventory');
        }

        function loadSkillsScreen() {
            mainScreen.classList.remove('ascii-map-mode'); // ç§»é™¤åœ°åœ–æ¨¡å¼çš„å°é½Šæ¨£å¼
            mainScreen.innerHTML = `
                <div class="generic-screen">
                    <h3>å­¸ç¿’æŠ€èƒ½</h3>
                    <p>ä½ é‚„æ²’æœ‰å­¸ç¿’ä»»ä½•æŠ€èƒ½ã€‚(å‰å¾€è¨“ç·´å¸«å­¸ç¿’å§)</p>
                    <p>æœªä¾†é€™è£¡æœƒé¡¯ç¤ºä½ å­¸åˆ°çš„æŠ€èƒ½å’ŒæŠ€èƒ½é»æ•¸ã€‚</p>
                </div>
            `;
            addMessage('ä½ æŸ¥çœ‹äº†æŠ€èƒ½ã€‚', 'system');
            GameEventEmitter.emit('screenChanged', 'Skills');
        }

        function loadStatusScreen() {
            mainScreen.classList.remove('ascii-map-mode'); // ç§»é™¤åœ°åœ–æ¨¡å¼çš„å°é½Šæ¨£å¼
            mainScreen.innerHTML = `
                <div class="generic-screen">
                    <h3>è§’è‰²ç‹€æ…‹</h3>
                    <p>åç¨±ï¼šå†’éšªè€…</p>
                    <p>ç­‰ç´šï¼š1</p>
                    <p>ç”Ÿå‘½å€¼ï¼š100/100</p>
                    <p>é‡‘å¹£ï¼š50</p>
                    <p>ç¶“é©—å€¼ï¼š0/100</p>
                </div>
            `;
            addMessage('ä½ æŸ¥çœ‹äº†ä½ çš„è§’è‰²ç‹€æ…‹ã€‚', 'system');
            GameEventEmitter.emit('screenChanged', 'Status');
        }

        // gameLogic.js å…§å®¹ (å·²æ•´åˆåˆ°æ­¤æª”æ¡ˆä¸­)
        let currentScreen = 'villageMap';
        let playerLocation = 'æ‘èŠå»£å ´';

        function setupControls() {
            document.getElementById('btn-explore').addEventListener('click', () => {
                if (currentScreen !== 'villageMap') {
                    loadVillageMap();
                    currentScreen = 'villageMap';
                } else {
                    addMessage('ä½ å·²ç¶“åœ¨åœ°åœ–ç•«é¢äº†ï¼Œå¯ä»¥é»æ“Šåœ°åœ–ä¸Šçš„åœ°é»ã€‚', 'system');
                }
            });

            document.getElementById('btn-inventory').addEventListener('click', () => {
                loadInventoryScreen();
                currentScreen = 'inventory';
            });

            document.getElementById('btn-skills').addEventListener('click', () => {
                loadSkillsScreen();
                currentScreen = 'skills';
            });

            document.getElementById('btn-status').addEventListener('click', () => {
                loadStatusScreen();
                currentScreen = 'status';
            });

            document.getElementById('btn-save').addEventListener('click', () => {
                addMessage('éŠæˆ²å·²å„²å­˜ï¼(å¯¦éš›å„²å­˜åŠŸèƒ½å¾…é–‹ç™¼)', 'system');
            });
        }

        // ç›£è½åœ°åœ–åœ°é»é»æ“Šäº‹ä»¶
        GameEventEmitter.on('mapLocationClicked', (locationName) => {
            playerLocation = locationName;
            addMessage(`ä½ ä¾†åˆ°äº†ã€Œ${locationName}ã€ã€‚`, 'event');
            switch (locationName) {
                case 'æ³¢å…”é›œè²¨åº—':
                    addMessage('é›œè²¨åº—è€é—†èƒ–æ³¢èªªï¼šã€Œæ­¡è¿å…‰è‡¨ï¼æƒ³è²·äº›ä»€éº¼å‘¢ï¼Ÿã€', 'dialog');
                    // TODO: è¼‰å…¥å•†åº—ä»‹é¢
                    break;
                case 'ç†Šå¤§éµåŒ é‹ª':
                    addMessage('éµåŒ ç†Šå¤§æ­£åœ¨å®å®å™¹å™¹åœ°æ•²æ‰“è‘—ä»€éº¼ã€‚', 'dialog');
                    // TODO: è¼‰å…¥éµåŒ é‹ªä»‹é¢
                    break;
                case 'å—ç“œæ£®æ—å…¥å£':
                    addMessage('æ£®æ—æ·±è™•å‚³ä¾†æœªçŸ¥ç”Ÿç‰©çš„è²éŸ³ï¼Œä½ æº–å‚™å¥½å‰å¾€å†’éšªäº†å—ï¼Ÿ', 'dialog');
                    // TODO: è¼‰å…¥æ¢ç´¢æˆ–æˆ°é¬¥ç•«é¢
                    break;
                case 'æˆ‘çš„å°å±‹':
                    addMessage('é€™æ˜¯ä½ æº«é¦¨çš„å°å±‹ï¼Œè®“ä½ æ„Ÿåˆ°æ”¾é¬†ã€‚', 'dialog');
                    // TODO: ä¼‘æ¯/å›å¾©ä»‹é¢
                    break;
                case 'æ‘é•·å¸‚æ”¿å»³':
                    addMessage('æ‘é•·æ­£åœ¨å¸‚æ”¿å»³è£¡ç­‰å¾…è‘—ï¼Œä¼¼ä¹æœ‰æ–°ä»»å‹™ã€‚', 'dialog');
                    // TODO: ä»»å‹™ä»‹é¢
                    break;
                case 'èƒ–æ³¢è¾²å ´':
                    addMessage('èƒ–æ³¢æ­£åœ¨è¾²å ´è£¡è¾›å‹¤åœ°ç¨®æ¤è˜¿è””ã€‚', 'dialog');
                    // TODO: è¾²å ´äº’å‹•æˆ–å°éŠæˆ²
                    break;
                default:
                    break;
            }
        });

        // ç›£è½ç•«é¢åˆ‡æ›äº‹ä»¶
        GameEventEmitter.on('screenChanged', (screenName) => {
            console.log(`ç•«é¢å·²åˆ‡æ›åˆ°ï¼š${screenName}`);
        });

        // init.js å…§å®¹ (å·²æ•´åˆåˆ°æ­¤æª”æ¡ˆä¸­)
        document.addEventListener('DOMContentLoaded', () => {
            loadVillageMap(); // éŠæˆ²å•Ÿå‹•æ™‚é è¨­è¼‰å…¥æ‘èŠåœ°åœ–
            setupControls(); // è¨­å®šæŒ‰éˆ•äº‹ä»¶
        });
    </script>

</body>
</html>
