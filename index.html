<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>胖波往上跳！</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <style>
    * {
      box-sizing: border-box;
      padding: 0;
      margin: 0;
    }

    body {
      background-color: #111;
      overflow: hidden;
    }

    canvas {
      display: block;
    }

    #controls {
      position: fixed;
      bottom: 20px;
      width: 100%;
      display: flex;
      justify-content: center;
      gap: 16px;
      z-index: 10;
    }

    .ctrl-btn {
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.1);
      border: 2px solid #aaa;
      color: white;
      font-size: 24px;
      text-align: center;
      line-height: 56px;
      user-select: none;
      cursor: pointer;
    }

    .ctrl-btn:active {
      background: rgba(255, 255, 255, 0.3);
    }
  </style>
</head>
<body>

<div id="controls">
  <div class="ctrl-btn" ontouchstart="left=true" ontouchend="left=false">&#8592;</div>
  <div class="ctrl-btn" ontouchstart="jump=true" ontouchend="jump=false">&#8593;</div>
  <div class="ctrl-btn" ontouchstart="right=true" ontouchend="right=false">&#8594;</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/phaser@3/dist/phaser.js"></script>
<script>
  let left = false, right = false, jump = false;

  const config = {
    type: Phaser.AUTO,
    width: window.innerWidth,
    height: window.innerHeight,
    backgroundColor: '#111111',
    physics: {
      default: 'arcade',
      arcade: {
        gravity: { y: 600 },
        debug: false
      }
    },
    scene: {
      preload,
      create,
      update
    }
  };

  const game = new Phaser.Game(config);
  let pokotaContainer;
  let platforms;
  let cursors;
  let isJumping = false;

  function preload() {}

  function create() {
    // 平台群組
    platforms = this.physics.add.staticGroup();
    for (let i = 0; i < 10; i++) {
      const x = Phaser.Math.Between(50, config.width - 100);
      const y = config.height - i * 120;
      const platform = this.add.rectangle(x, y, 100, 20, 0x115533);
      this.physics.add.existing(platform, true);
      platforms.add(platform);
    }

    // 胖波圖形（粉紅圓＋大寫P）
    const pokota = this.add.graphics();
    pokota.fillStyle(0xff69b4, 1);
    pokota.fillCircle(0, 0, 20);

    const label = this.add.text(-9, -15, 'P', {
      fontSize: '24px',
      color: '#000000',
      fontFamily: 'sans-serif'
    });

    pokotaContainer = this.add.container(config.width / 2, config.height - 100, [pokota, label]);
    this.physics.add.existing(pokotaContainer);
    pokotaContainer.body.setCollideWorldBounds(true);
    pokotaContainer.body.setBounce(0.2);

    this.physics.add.collider(pokotaContainer, platforms);

    // 鏡頭跟著胖波移動
    this.cameras.main.startFollow(pokotaContainer);
    this.cameras.main.setLerp(0.1, 0.1);
  }

  function update() {
    const body = pokotaContainer.body;

    // 左右移動
    if (left) {
      body.setVelocityX(-200);
    } else if (right) {
      body.setVelocityX(200);
    } else {
      body.setVelocityX(0);
    }

    // 跳躍控制（只有站在平台上時才跳）
    if (jump && body.touching.down && !isJumping) {
      body.setVelocityY(-400);
      isJumping = true;
    }

    if (!jump) {
      isJumping = false;
    }

    // 平台整體往下移動
    platforms.children.iterate((platform) => {
      platform.y += 0.5;
      platform.body.updateFromGameObject();
    });
  }
</script>
</body>
</html>